import{Q as d}from"./index-BOPlgZ3J.js";import"./mockData-Da8oLpbF.js";const m=()=>typeof window<"u"?(window.__CJ_CACHE__||(window.__CJ_CACHE__={categories:null,products:{},activeRequests:new Map}),window.__CJ_CACHE__):{categories:null,products:{},activeRequests:new Map},e=m(),N={getSupplierProducts:async(t={})=>{const{page:s=1,size:r=20,keyWord:a="",categoryId:i=""}=t,c=`products_${s}_${r}_${a}_${i}`;if(e.products[c])return console.log(`[Cache Hit] Products: ${c}`),e.products[c];if(e.activeRequests.has(c))return console.log(`[Deduplicating] Products: ${c}`),e.activeRequests.get(c);const p=(async()=>{try{console.log(`[Network Request] Products: ${c}`),console.log(`[Network Request] Products: ${c}`);const l=(await d.get("/cj/list-products-v2",{params:{page:s,size:r,keyWord:a,categoryId:i}})).data;if(l.result===!0||l.success===!0){const n=l.data,h={products:(n.content?.[0]?.productList||n.list||[]).map(o=>{const y=(P,_=1)=>{if(!P)return"0.00";const g=String(P);return g.includes("--")?g.split("--").map(C=>Math.round(parseFloat(C.trim())*_*83)).join(" -- "):Math.round(parseFloat(g)*_*83).toString()},R=y(o.sellPrice,1.3);return{id:o.id||o.pid,name:o.nameEn||o.productNameEn,image:o.bigImage||o.productImage,category:o.categoryName||o.oneCategoryName||"General",categoryId:o.categoryId,sellPrice:R,supplierPrice:y(o.sellPrice,1),price:R,margin:30,stock:o.warehouseInventoryNum||"Global",pid:o.id||o.pid}}),totalPages:n.totalPages||Math.ceil((n.totalRecords||0)/r)||1,totalItems:n.totalRecords||n.total||0};return e.products[c]=h,h}throw new Error(l.message||"Failed to fetch products")}catch(u){throw console.error("Fetch Products Error:",u),u}finally{e.activeRequests.delete(c)}})();return e.activeRequests.set(c,p),p},fetchCategories:async()=>{if(e.categories)return console.log("[Cache Hit] Categories"),e.categories;const t="categories_main";if(e.activeRequests.has(t))return console.log("[Deduplicating] Categories"),e.activeRequests.get(t);const s=(async()=>{try{console.log("[Network Request] Categories"),console.log("[Network Request] Categories");const r=await d.get("/cj/get-categories");if(r.data.success&&r.data.code===200){const a=r.data.data;return e.categories=a,a}return[]}catch(r){return console.error("Fetch Categories Error:",r),[]}finally{e.activeRequests.delete(t)}})();return e.activeRequests.set(t,s),s},clearCache:()=>{console.log("[Cache Cleared]"),e.categories=null,e.products={},e.activeRequests.clear()},updateProductMargin:async(t,s)=>(console.log(`Product ${t} margin updated to ${s}%`),{success:!0,id:t,margin:s}),getProductDetails:async t=>{const s=`detail_${t}`;if(e.products[s])return console.log(`[Cache Hit] Product Detail: ${t}`),e.products[s];if(e.activeRequests.has(s))return console.log(`[Deduplicating] Product Detail: ${t}`),e.activeRequests.get(s);const r=(async()=>{try{console.log(`[Network Request] Product Detail: ${t}`),console.log(`[Network Request] Product Detail: ${t}`);const i=(await d.get("/cj/product-details",{params:{pid:t}})).data;return e.products[s]=i,i}catch(a){throw console.error("Fetch Product Details Error:",a),a}finally{e.activeRequests.delete(s)}})();return e.activeRequests.set(s,r),r},toggleProductVisibility:async(t,s)=>(console.log(`Product ${t} visibility set to ${s}`),{success:!0,id:t,visible:s})};export{N as p};
