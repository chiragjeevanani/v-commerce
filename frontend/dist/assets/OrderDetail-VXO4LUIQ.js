import{q as F,h as U,i as B,b as T,r as i,j as e,B as l,C as v,P as b,Z as $,M,o as E,l as L,a2 as I,a3 as P,a4 as q,a5 as z,a6 as H,a7 as G}from"./index-Wtch0-zL.js";import{o as y}from"./orders.service-KonBOVQx.js";import{S as R}from"./StatusBadge-ElQbiMJr.js";import{C as m,c as x,d as u,a as p}from"./card-D9j2Wq-Q.js";import{S as w}from"./separator-B6VQ28gC.js";import{L as S}from"./loader-circle--Z4VTzrd.js";import{C as Z}from"./calendar-c9lMxmVH.js";import{T as C}from"./truck-BIxadlMC.js";import{C as _}from"./circle-check-big-uWFyOx4b.js";import{C as K}from"./circle-check-Dkg5XSin.js";import"./mockData-Da8oLpbF.js";import"./index-DE7YZteN.js";const V=[["path",{d:"M4 2v20l2-1 2 1 2-1 2 1 2-1 2 1 2-1 2 1V2l-2 1-2-1-2 1-2-1-2 1-2-1-2 1Z",key:"q3az6g"}],["path",{d:"M16 8h-6a2 2 0 1 0 0 4h4a2 2 0 1 1 0 4H8",key:"1h4pet"}],["path",{d:"M12 17.5v-11",key:"1jc1ny"}]],J=F("receipt",V),ne=()=>{const{id:d}=U(),h=B(),{toast:n}=T(),[t,g]=i.useState(null),[f,k]=i.useState(!0),[c,j]=i.useState(!1),[r,o]=i.useState({open:!1,newStatus:null});i.useEffect(()=>{d&&(async()=>{try{const a=await y.getOrderById(d);g(a)}catch(a){console.error("Failed to load order:",a),n({title:"Error",description:"Failed to load order details.",variant:"destructive"})}finally{k(!1)}})()},[d]);const A=async s=>{if(!s){console.error("No status provided");return}console.log("Updating order status:",{orderId:d,newStatus:s}),j(!0);try{const a=await y.updateOrderStatus(d,s);console.log("Status updated successfully:",a),g(a),n({title:"Success",description:`Order status updated to ${s}`}),o({open:!1,newStatus:null})}catch(a){console.error("Failed to update status:",a),console.error("Error details:",a.response?.data||a.message),n({title:"Error",description:a.response?.data?.message||a.message||"Failed to update order status.",variant:"destructive"})}finally{j(!1)}},N=()=>{const s=["placed","confirmed","shipped","delivered"],a=s.indexOf(t?.status);return a===-1||a===s.length-1?null:s[a+1]},O=s=>({confirmed:{label:"Confirm Order",icon:K,variant:"default"},shipped:{label:"Mark as Shipped",icon:C,variant:"default"},delivered:{label:"Mark as Delivered",icon:_,variant:"default"}})[s];if(f)return e.jsx("div",{className:"flex h-[80vh] items-center justify-center",children:e.jsx(S,{className:"h-8 w-8 animate-spin text-primary"})});if(!t)return e.jsxs("div",{className:"flex flex-col items-center justify-center h-[60vh] gap-4",children:[e.jsx("p",{className:"text-muted-foreground",children:"Order not found."}),e.jsxs(l,{variant:"outline",onClick:()=>h("/admin/orders"),children:[e.jsx(v,{className:"mr-2 h-4 w-4"})," Back to Orders"]})]});const D=typeof t.shippingAddress=="string"?t.shippingAddress:t.shippingAddress?`${t.shippingAddress.fullName||""}, ${t.shippingAddress.street||""}, ${t.shippingAddress.city||""}, ${t.shippingAddress.state||""}, ${t.shippingAddress.country||""} - ${t.shippingAddress.zipCode||""}`:"N/A";return e.jsxs("div",{className:"space-y-6 pb-10",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(l,{variant:"outline",size:"icon",onClick:()=>h("/admin/orders"),children:e.jsx(v,{className:"h-4 w-4"})}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("h1",{className:"text-2xl font-bold tracking-tight",children:["Order #",t.id?.slice(-8).toUpperCase()]}),e.jsx(R,{status:t.status})]}),e.jsxs("div",{className:"flex items-center gap-2 text-muted-foreground mt-1 text-sm",children:[e.jsx(Z,{className:"h-3 w-3"}),new Date(t.createdAt||t.date).toLocaleString()]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[t&&N()&&(()=>{const s=N(),a=O(s);return a?e.jsxs(l,{variant:a.variant,className:"gap-2",onClick:()=>{console.log("Button clicked, opening dialog with status:",s),o({open:!0,newStatus:s})},disabled:c||f,children:[e.jsx(a.icon,{className:"h-4 w-4"})," ",a.label]}):null})(),e.jsxs(l,{variant:"outline",className:"gap-2",children:[e.jsx(J,{className:"h-4 w-4"})," Invoice"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsxs(m,{children:[e.jsx(x,{className:"border-b bg-muted/20",children:e.jsxs(u,{className:"text-base flex items-center gap-2",children:[e.jsx(b,{className:"h-4 w-4 text-muted-foreground"})," Order Items"]})}),e.jsx(p,{className:"p-0",children:e.jsx("div",{className:"divide-y",children:t.items?.map((s,a)=>e.jsxs("div",{className:"flex gap-4 p-4 items-center",children:[e.jsx("div",{className:"h-16 w-16 rounded-lg overflow-hidden border bg-background shrink-0",children:s.image?e.jsx("img",{src:s.image,alt:s.name,className:"h-full w-full object-cover"}):e.jsx("div",{className:"h-full w-full flex items-center justify-center bg-muted text-muted-foreground",children:e.jsx(b,{className:"h-6 w-6"})})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium truncate",children:s.name}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["SKU: ",s.sku||s.pid||"N/A"]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"font-bold",children:["₹",(s.price||0).toFixed(2)]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["x ",s.quantity]})]}),e.jsxs("div",{className:"text-right w-24 font-bold",children:["₹",((s.price||0)*(s.quantity||1)).toFixed(2)]})]},a))})})]}),e.jsxs(m,{children:[e.jsx(x,{className:"border-b bg-muted/20",children:e.jsxs(u,{className:"text-base flex items-center gap-2",children:[e.jsx(C,{className:"h-4 w-4 text-muted-foreground"})," Order Timeline"]})}),e.jsx(p,{className:"p-6",children:e.jsx("div",{className:"relative border-l-2 border-muted ml-3 space-y-8",children:t.timeline?.map((s,a)=>e.jsxs("div",{className:"relative pl-6",children:[e.jsx("div",{className:`absolute -left-[9px] top-0 h-4 w-4 rounded-full border-2 ${s.completed?"bg-primary border-primary":"bg-background border-muted"}`}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:`text-sm font-medium ${s.completed?"text-primary":"text-muted-foreground"}`,children:s.label}),s.date&&e.jsx("span",{className:"text-xs text-muted-foreground",children:new Date(s.date).toLocaleString()})]})]},a))})})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs(m,{children:[e.jsx(x,{className:"border-b bg-muted/20 pb-3",children:e.jsxs(u,{className:"text-base flex items-center gap-2",children:[e.jsx($,{className:"h-4 w-4 text-muted-foreground"})," Customer"]})}),e.jsxs(p,{className:"p-4 space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-10 w-10 rounded-full bg-primary/10 flex items-center justify-center text-primary font-bold",children:t.user?.name?.[0]||t.customer?.name?.[0]||"G"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:t.user?.name||t.customer?.name||"Guest"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:t.user?.email||"No email provided"})]})]}),e.jsx(w,{}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm font-medium text-muted-foreground",children:[e.jsx(M,{className:"h-4 w-4"})," Shipping Address"]}),e.jsx("p",{className:"text-sm leading-relaxed pl-6",children:D})]})]})]}),e.jsxs(m,{children:[e.jsx(x,{className:"border-b bg-muted/20 pb-3",children:e.jsxs(u,{className:"text-base flex items-center gap-2",children:[e.jsx(E,{className:"h-4 w-4 text-muted-foreground"})," Payment"]})}),e.jsxs(p,{className:"p-4 space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center bg-muted/30 p-3 rounded-lg border",children:[e.jsx("span",{className:"text-sm font-medium",children:t.paymentMethod||"Card"}),e.jsx(L,{variant:"secondary",className:"bg-green-100 text-green-700 border-green-200",children:"Paid"})]}),e.jsxs("div",{className:"space-y-2 pt-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Subtotal"}),e.jsxs("span",{children:["₹",(t.total||t.totalAmount||0).toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Shipping"}),e.jsx("span",{children:"₹0.00"})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Tax"}),e.jsx("span",{children:"₹0.00"})]}),e.jsx(w,{className:"my-2"}),e.jsxs("div",{className:"flex justify-between font-bold text-lg",children:[e.jsx("span",{children:"Total"}),e.jsxs("span",{className:"text-primary",children:["₹",(t.total||t.totalAmount||0).toFixed(2)]})]})]})]})]})]})]}),e.jsx(I,{open:r.open,onOpenChange:s=>{console.log("Dialog open state changed:",s),s||o({open:!1,newStatus:null})},children:e.jsxs(P,{children:[e.jsxs(q,{children:[e.jsx(z,{children:"Update Order Status"}),e.jsxs(H,{children:["Are you sure you want to update this order status to ",e.jsx("strong",{children:r.newStatus}),"?",r.newStatus==="delivered"&&" This action cannot be undone."]})]}),e.jsxs(G,{children:[e.jsx(l,{variant:"outline",onClick:()=>{console.log("Cancel clicked"),o({open:!1,newStatus:null})},disabled:c,children:"Cancel"}),e.jsx(l,{onClick:()=>{console.log("Update button clicked, status:",r.newStatus),r.newStatus?A(r.newStatus):(console.error("No status to update"),n({title:"Error",description:"No status selected",variant:"destructive"}))},disabled:c||!r.newStatus,children:c?e.jsxs(e.Fragment,{children:[e.jsx(S,{className:"mr-2 h-4 w-4 animate-spin"})," Updating..."]}):"Update Status"})]})]})})]})};export{ne as default};
