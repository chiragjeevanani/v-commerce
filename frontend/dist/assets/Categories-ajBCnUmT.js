import{q as de,b as B,r as i,j as e,N as z,B as d,O as Ce,m as J,l as K,aG as Se,a as we,_ as Y,$ as ee,a0 as se,a1 as S,ag as te,T as ae,A as Ae,a2 as T,a3 as O,a4 as M,a5 as P,a6 as I,a7 as ie}from"./index-Wtch0-zL.js";import{C as U,a as q,c as Fe}from"./card-D9j2Wq-Q.js";import{L as V}from"./label-W3Hee3RC.js";import{C as oe}from"./checkbox-CH1_LDE4.js";import{c as b}from"./category.service-D0qAaHmW.js";import{T as ke,S as re}from"./textarea-DhEgoe15.js";import{L as D}from"./loader-circle--Z4VTzrd.js";import{P as H}from"./plus-B6PqWma_.js";import{E as $}from"./eye-DyXlGjoB.js";import{E as le}from"./ellipsis-B6ut3Bvq.js";import{E as ne}from"./eye-off-A8m0ihYJ.js";import"./index-DE7YZteN.js";import"./index-C56d_6eh.js";const De=[["path",{d:"m6 14 1.5-2.9A2 2 0 0 1 9.24 10H20a2 2 0 0 1 1.94 2.5l-1.54 6a2 2 0 0 1-1.95 1.5H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h3.9a2 2 0 0 1 1.69.9l.81 1.2a2 2 0 0 0 1.67.9H18a2 2 0 0 1 2 2v2",key:"usdka0"}]],Ee=de("folder-open",De);const _e=[["path",{d:"M20 20a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z",key:"1kt360"}]],ce=de("folder",_e),Le=({category:t,onSuccess:l,onCancel:k})=>{const{toast:u}=B(),[p,N]=i.useState(!1),[v,j]=i.useState(null),[h,y]=i.useState(t?.image||""),[c,n]=i.useState({name:t?.name||"",description:t?.description||"",isActive:t?.isActive!==void 0?t.isActive:!0}),r=x=>{const{name:a,value:g,type:A,checked:E}=x.target;n(F=>({...F,[a]:A==="checkbox"?E:g}))},f=x=>{const a=x.target.files[0];a&&(j(a),y(URL.createObjectURL(a)))},w=async x=>{if(x.preventDefault(),!c.name||!c.description){u({title:"Validation Error",description:"Please fill in all required fields.",variant:"destructive"});return}if(!v&&!t?.image){u({title:"Validation Error",description:"Please select an image for the category.",variant:"destructive"});return}N(!0);try{const a=new FormData;a.append("name",c.name),a.append("description",c.description),a.append("isActive",c.isActive),v&&a.append("image",v);let g;t?g=await b.updateCategory(t._id,a):g=await b.createCategory(a),g.success&&(u({title:"Success",description:t?"Category updated successfully.":"Category created successfully."}),l())}catch(a){const g=a.response?.data?.message||(t?"Failed to update category.":"Failed to create category.");u({title:"Error",description:g,variant:"destructive"})}finally{N(!1)}};return e.jsxs("form",{onSubmit:w,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{htmlFor:"name",children:"Category Name *"}),e.jsx(z,{id:"name",name:"name",value:c.name,onChange:r,placeholder:"e.g., Electronics",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{htmlFor:"description",children:"Description *"}),e.jsx(ke,{id:"description",name:"description",value:c.description,onChange:r,placeholder:"e.g., All electronic products and gadgets",rows:3,required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{htmlFor:"image",children:"Category Image *"}),e.jsx(z,{id:"image",name:"image",type:"file",accept:"image/*",onChange:f,className:"cursor-pointer",required:!t}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Recommended size: 400x400px"}),h&&e.jsx("div",{className:"mt-2 rounded-lg overflow-hidden border bg-muted/20",children:e.jsx("img",{src:h,alt:"Preview",className:"w-full h-40 object-cover"})})]}),e.jsx("div",{className:"space-y-2",children:e.jsxs("div",{className:"flex items-center space-x-2 h-10",children:[e.jsx(oe,{id:"isActive",name:"isActive",checked:c.isActive,onCheckedChange:x=>n(a=>({...a,isActive:x}))}),e.jsx("label",{htmlFor:"isActive",className:"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70",children:"Active (visible to customers)"})]})}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4",children:[e.jsx(d,{type:"button",variant:"outline",onClick:k,disabled:p,children:"Cancel"}),e.jsx(d,{type:"submit",disabled:p,children:p?e.jsxs(e.Fragment,{children:[e.jsx(D,{className:"mr-2 h-4 w-4 animate-spin"}),t?"Updating...":"Creating..."]}):t?"Update Category":"Create Category"})]})]})},Ge=()=>{const{toast:t}=B(),[l,k]=i.useState(""),[u,p]=i.useState([]),[N,v]=i.useState(!0),[j,h]=i.useState(!1),[y,c]=i.useState(null),[n,r]=i.useState(null),[f,w]=i.useState(!1),[x,a]=i.useState(!1),[g,A]=i.useState(null),[E,F]=i.useState(null),[_,L]=i.useState(null),[R,Q]=i.useState(!1),[G,me]=i.useState(new Set),C=async()=>{v(!0);try{const s=await b.getAllCategories();s.success&&p(s.data)}catch(s){console.error("Fetch Categories Error:",s),t({title:"Error",description:"Failed to load categories.",variant:"destructive"})}finally{v(!1)}};i.useEffect(()=>{C()},[]);const W=()=>{c(null),h(!0)},ue=s=>{c(s),h(!0)},he=()=>{h(!1),c(null),C()},xe=async()=>{if(n){w(!0);try{(await b.deleteCategory(n._id)).success&&(t({title:"Success",description:"Category deleted successfully."}),C())}catch(s){const o=s.response?.data?.message||"Failed to delete category.";t({title:"Error",description:o,variant:"destructive"})}finally{w(!1),r(null)}}},ge=async s=>{try{(await b.updateCategory(s._id,{name:s.name,description:s.description,isActive:!s.isActive})).success&&(t({title:"Success",description:`Category ${s.isActive?"deactivated":"activated"} successfully.`}),C())}catch{t({title:"Error",description:"Failed to update category status.",variant:"destructive"})}},X=s=>{A(s),F(null),a(!0)},pe=(s,o)=>{A(o),F(s),a(!0)},je=()=>{a(!1),F(null),A(null),C()},ve=async()=>{if(_){Q(!0);try{(await b.deleteSubcategory(_._id)).success&&(t({title:"Success",description:"Subcategory deleted successfully."}),C())}catch{t({title:"Error",description:"Failed to delete subcategory.",variant:"destructive"})}finally{Q(!1),L(null)}}},fe=async s=>{try{(await b.updateSubcategory(s._id,{name:s.name,isActive:!s.isActive})).success&&(t({title:"Success",description:`Subcategory ${s.isActive?"deactivated":"activated"} successfully.`}),C())}catch{t({title:"Error",description:"Failed to update subcategory status.",variant:"destructive"})}},be=s=>{me(o=>{const m=new Set(o);return m.has(s)?m.delete(s):m.add(s),m})},Z=u.filter(s=>s.name.toLowerCase().includes(l.toLowerCase())||s.description.toLowerCase().includes(l.toLowerCase())),Ne=u.filter(s=>s.isActive).length,ye=u.reduce((s,o)=>s+(o.subcategories?.length||0),0);return e.jsxs("div",{className:"space-y-6 pb-10",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Categories & Subcategories"}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Manage product categories and their subcategories."})]}),e.jsxs(d,{onClick:W,className:"gap-2",children:[e.jsx(H,{className:"h-4 w-4"}),"Add New Category"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsx(U,{className:"bg-primary/5 border-primary/20",children:e.jsxs(q,{className:"p-6 flex items-center gap-4",children:[e.jsx("div",{className:"p-3 bg-primary/10 rounded-xl text-primary",children:e.jsx(ce,{className:"h-6 w-6"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground font-medium",children:"Total Categories"}),e.jsx("p",{className:"text-2xl font-bold",children:u.length})]})]})}),e.jsx(U,{className:"bg-green-50 dark:bg-green-950/20 border-green-100 dark:border-green-900/50",children:e.jsxs(q,{className:"p-6 flex items-center gap-4",children:[e.jsx("div",{className:"p-3 bg-green-100 dark:bg-green-900/40 rounded-xl text-green-600 dark:text-green-400",children:e.jsx($,{className:"h-6 w-6"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground font-medium",children:"Active Categories"}),e.jsx("p",{className:"text-2xl font-bold",children:Ne})]})]})}),e.jsx(U,{className:"bg-blue-50 dark:bg-blue-950/20 border-blue-100 dark:border-blue-900/50",children:e.jsxs(q,{className:"p-6 flex items-center gap-4",children:[e.jsx("div",{className:"p-3 bg-blue-100 dark:bg-blue-900/40 rounded-xl text-blue-600 dark:text-blue-400",children:e.jsx(Ee,{className:"h-6 w-6"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground font-medium",children:"Total Subcategories"}),e.jsx("p",{className:"text-2xl font-bold",children:ye})]})]})})]}),e.jsxs(U,{children:[e.jsx(Fe,{className:"border-b bg-muted/20",children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"relative w-full max-w-sm",children:[e.jsx(Ce,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(z,{placeholder:"Search categories...",className:"pl-10",value:l,onChange:s=>k(s.target.value)})]})})}),e.jsx(q,{className:"p-0",children:e.jsx("div",{className:"relative w-full overflow-auto",children:N?e.jsxs("div",{className:"flex flex-col items-center justify-center py-20 gap-4",children:[e.jsx(D,{className:"h-8 w-8 text-primary animate-spin"}),e.jsx("p",{className:"text-muted-foreground",children:"Loading categories..."})]}):Z.length===0?e.jsxs("div",{className:"text-center py-20",children:[e.jsx(ce,{className:"h-12 w-12 text-muted-foreground mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-bold",children:"No categories found"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:"Create your first category to get started."}),e.jsxs(d,{onClick:W,className:"gap-2",children:[e.jsx(H,{className:"h-4 w-4"}),"Add New Category"]})]}):e.jsx("div",{className:"divide-y",children:Z.map((s,o)=>e.jsx(J.div,{initial:{opacity:0},animate:{opacity:1},transition:{delay:o*.05},className:"hover:bg-muted/50 transition-colors",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"flex items-start gap-4 flex-1",children:[e.jsx("div",{className:"h-16 w-16 rounded-lg overflow-hidden bg-muted flex-shrink-0",children:e.jsx("img",{src:s.image,alt:s.name,className:"w-full h-full object-cover"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("h3",{className:"font-bold text-lg",children:s.name}),e.jsx(K,{variant:"outline",className:s.isActive?"bg-green-50 text-green-700 border-green-200":"bg-slate-50 text-slate-700 border-slate-200",children:s.isActive?"Active":"Inactive"})]}),e.jsx("p",{className:"text-sm text-muted-foreground line-clamp-2",children:s.description}),e.jsx("div",{className:"flex items-center gap-4 mt-2",children:e.jsxs("span",{className:"text-xs text-muted-foreground",children:[s.subcategories?.length||0," subcategories"]})})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(d,{variant:"ghost",size:"sm",onClick:()=>be(s._id),className:"gap-2",children:G.has(s._id)?e.jsxs(e.Fragment,{children:[e.jsx(Se,{className:"h-4 w-4"}),"Hide Subcategories"]}):e.jsxs(e.Fragment,{children:[e.jsx(we,{className:"h-4 w-4"}),"View Subcategories"]})}),e.jsxs(Y,{children:[e.jsx(ee,{asChild:!0,children:e.jsx(d,{variant:"ghost",size:"icon",children:e.jsx(le,{className:"h-4 w-4"})})}),e.jsxs(se,{align:"end",className:"w-48",children:[e.jsxs(S,{onClick:()=>ue(s),children:[e.jsx(re,{className:"mr-2 h-4 w-4"})," Edit Category"]}),e.jsxs(S,{onClick:()=>X(s),children:[e.jsx(H,{className:"mr-2 h-4 w-4"})," Add Subcategory"]}),e.jsx(S,{onClick:()=>ge(s),children:s.isActive?e.jsxs(e.Fragment,{children:[e.jsx(ne,{className:"mr-2 h-4 w-4"})," Deactivate"]}):e.jsxs(e.Fragment,{children:[e.jsx($,{className:"mr-2 h-4 w-4"})," Activate"]})}),e.jsx(te,{}),e.jsxs(S,{className:"text-red-500",onClick:()=>r(s),children:[e.jsx(ae,{className:"mr-2 h-4 w-4"})," Delete Category"]})]})]})]})]}),e.jsx(Ae,{children:G.has(s._id)&&e.jsx(J.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},transition:{duration:.2},className:"mt-4 pt-4 border-t",children:s.subcategories&&s.subcategories.length>0?e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"font-semibold text-sm mb-3",children:"Subcategories"}),s.subcategories.map(m=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-muted/30 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"font-medium",children:m.name}),e.jsx(K,{variant:"outline",className:m.isActive?"bg-green-50 text-green-700 border-green-200":"bg-slate-50 text-slate-700 border-slate-200",children:m.isActive?"Active":"Inactive"})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs(Y,{children:[e.jsx(ee,{asChild:!0,children:e.jsx(d,{variant:"ghost",size:"icon",className:"h-8 w-8",children:e.jsx(le,{className:"h-3 w-3"})})}),e.jsxs(se,{align:"end",className:"w-48",children:[e.jsxs(S,{onClick:()=>pe(m,s),children:[e.jsx(re,{className:"mr-2 h-4 w-4"})," Edit Subcategory"]}),e.jsx(S,{onClick:()=>fe(m),children:m.isActive?e.jsxs(e.Fragment,{children:[e.jsx(ne,{className:"mr-2 h-4 w-4"})," Deactivate"]}):e.jsxs(e.Fragment,{children:[e.jsx($,{className:"mr-2 h-4 w-4"})," Activate"]})}),e.jsx(te,{}),e.jsxs(S,{className:"text-red-500",onClick:()=>L(m),children:[e.jsx(ae,{className:"mr-2 h-4 w-4"})," Delete Subcategory"]})]})]})})]},m._id))]}):e.jsxs("div",{className:"text-center py-4",children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-3",children:"No subcategories yet"}),e.jsxs(d,{size:"sm",variant:"outline",onClick:()=>X(s),className:"gap-2",children:[e.jsx(H,{className:"h-3 w-3"}),"Add Subcategory"]})]})})})]})},s._id))})})})]}),e.jsx(T,{open:j,onOpenChange:h,children:e.jsxs(O,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(M,{children:[e.jsx(P,{children:y?"Edit Category":"Create New Category"}),e.jsx(I,{children:y?"Update the category details below.":"Fill in the details to create a new category."})]}),e.jsx(Le,{category:y,onSuccess:he,onCancel:()=>h(!1)})]})}),e.jsx(T,{open:x,onOpenChange:a,children:e.jsxs(O,{className:"max-w-md",children:[e.jsxs(M,{children:[e.jsx(P,{children:E?"Edit Subcategory":"Create New Subcategory"}),e.jsx(I,{children:g&&e.jsxs("span",{children:["For category: ",e.jsx("strong",{children:g.name})]})})]}),e.jsx(Te,{category:g,subcategory:E,onSuccess:je,onCancel:()=>{a(!1),F(null),A(null)}})]})}),e.jsx(T,{open:!!n,onOpenChange:()=>r(null),children:e.jsxs(O,{children:[e.jsxs(M,{children:[e.jsx(P,{children:"Delete Category"}),e.jsxs(I,{children:['Are you sure you want to delete "',n?.name,'"? This action cannot be undone.',n?.subcategories?.length>0&&e.jsxs("span",{className:"block mt-2 text-red-500",children:["Warning: This category has ",n.subcategories.length," subcategory(ies). Please delete them first."]})]})]}),e.jsxs(ie,{children:[e.jsx(d,{variant:"outline",onClick:()=>r(null),disabled:f,children:"Cancel"}),e.jsx(d,{variant:"destructive",onClick:xe,disabled:f,children:f?e.jsxs(e.Fragment,{children:[e.jsx(D,{className:"mr-2 h-4 w-4 animate-spin"})," Deleting..."]}):"Delete"})]})]})}),e.jsx(T,{open:!!_,onOpenChange:()=>L(null),children:e.jsxs(O,{children:[e.jsxs(M,{children:[e.jsx(P,{children:"Delete Subcategory"}),e.jsxs(I,{children:['Are you sure you want to delete "',_?.name,'"? This action cannot be undone.']})]}),e.jsxs(ie,{children:[e.jsx(d,{variant:"outline",onClick:()=>L(null),disabled:R,children:"Cancel"}),e.jsx(d,{variant:"destructive",onClick:ve,disabled:R,children:R?e.jsxs(e.Fragment,{children:[e.jsx(D,{className:"mr-2 h-4 w-4 animate-spin"})," Deleting..."]}):"Delete"})]})]})})]})},Te=({category:t,subcategory:l,onSuccess:k,onCancel:u})=>{const{toast:p}=B(),[N,v]=i.useState(!1),[j,h]=i.useState({name:l?.name||"",isActive:l?.isActive!==void 0?l.isActive:!0}),y=n=>{const{name:r,value:f,type:w,checked:x}=n.target;h(a=>({...a,[r]:w==="checkbox"?x:f}))},c=async n=>{if(n.preventDefault(),!j.name){p({title:"Validation Error",description:"Please enter a subcategory name.",variant:"destructive"});return}if(!t){p({title:"Error",description:"Category not selected.",variant:"destructive"});return}v(!0);try{let r;l?r=await b.updateSubcategory(l._id,j):r=await b.createSubcategory({categoryId:t._id,name:j.name,isActive:j.isActive}),r.success&&(p({title:"Success",description:l?"Subcategory updated successfully.":"Subcategory created successfully."}),k())}catch(r){const f=r.response?.data?.message||(l?"Failed to update subcategory.":"Failed to create subcategory.");p({title:"Error",description:f,variant:"destructive"})}finally{v(!1)}};return e.jsxs("form",{onSubmit:c,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{htmlFor:"subcategoryName",children:"Subcategory Name *"}),e.jsx(z,{id:"subcategoryName",name:"name",value:j.name,onChange:y,placeholder:"e.g., Smartphones",required:!0})]}),e.jsx("div",{className:"space-y-2",children:e.jsxs("div",{className:"flex items-center space-x-2 h-10",children:[e.jsx(oe,{id:"subcategoryIsActive",name:"isActive",checked:j.isActive,onCheckedChange:n=>h(r=>({...r,isActive:n}))}),e.jsx("label",{htmlFor:"subcategoryIsActive",className:"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70",children:"Active (visible to customers)"})]})}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4",children:[e.jsx(d,{type:"button",variant:"outline",onClick:u,disabled:N,children:"Cancel"}),e.jsx(d,{type:"submit",disabled:N,children:N?e.jsxs(e.Fragment,{children:[e.jsx(D,{className:"mr-2 h-4 w-4 animate-spin"}),l?"Updating...":"Creating..."]}):l?"Update Subcategory":"Create Subcategory"})]})]})};export{Ge as default};
