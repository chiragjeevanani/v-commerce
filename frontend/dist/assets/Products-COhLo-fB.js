import{q as O,r as a,j as e,a2 as G,a3 as H,a4 as J,a5 as W,a6 as K,a7 as X,B as l,i as Z,b as ee,l as j,O as se,N as ae,R as te,A as re,m as ie,C as le,a as ne,a8 as ce}from"./index-BpRMWdVM.js";import{p as S}from"./products.service-CJOEitO_.js";import{L}from"./label-XkaMJijg.js";import{S as de}from"./slider-BS68g0dW.js";import{S as oe}from"./switch-CLUz6FRI.js";import{I as me}from"./info-BXZQxidp.js";import{S as xe}from"./save-CsQWEPm2.js";import{C as R,a as V}from"./card-CyVSnPS_.js";import{L as he}from"./layout-grid-BP90qunA.js";import{S as pe}from"./shield-check-Bp4L0f9l.js";import{E as T}from"./eye-D0NRzLWa.js";import"./index-C_G7Jul-.js";import"./index-BdQq_4o_.js";import"./index-D0VtG131.js";const ge=[["rect",{width:"16",height:"20",x:"4",y:"2",rx:"2",key:"1nb95v"}],["line",{x1:"8",x2:"16",y1:"6",y2:"6",key:"x4nwl0"}],["line",{x1:"16",x2:"16",y1:"14",y2:"18",key:"wjye3r"}],["path",{d:"M16 10h.01",key:"1m94wz"}],["path",{d:"M12 10h.01",key:"1nrarc"}],["path",{d:"M8 10h.01",key:"19clt8"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M12 18h.01",key:"mhygvu"}],["path",{d:"M8 18h.01",key:"lrp35t"}]],ue=O("calculator",ge);const fe=[["path",{d:"M3 5h.01",key:"18ugdj"}],["path",{d:"M3 12h.01",key:"nlz23k"}],["path",{d:"M3 19h.01",key:"noohij"}],["path",{d:"M8 5h13",key:"1pao27"}],["path",{d:"M8 12h13",key:"1za7za"}],["path",{d:"M8 19h13",key:"m83p4d"}]],je=O("list",fe),ye=({product:i,isOpen:o,onClose:p,onSave:P})=>{const[m,y]=a.useState(30),[d,g]=a.useState(!0);if(a.useEffect(()=>{i&&(y(i.margin||30),g(!0))},[i]),!i)return null;const x=parseFloat(i.supplierPrice),u=(x*(1+m/100)).toFixed(2),C=(u-x).toFixed(2);return e.jsx(G,{open:o,onOpenChange:p,children:e.jsxs(H,{className:"sm:max-w-[500px]",children:[e.jsxs(J,{children:[e.jsx(W,{children:"Edit Product Pricing"}),e.jsx(K,{children:"Configure your markup and visibility for this dropshipped product."})]}),e.jsxs("div",{className:"space-y-6 py-4",children:[e.jsxs("div",{className:"flex gap-4 p-3 bg-muted rounded-xl border",children:[e.jsx("div",{className:"h-16 w-16 rounded-lg overflow-hidden border bg-background shrink-0",children:e.jsx("img",{src:i.image,alt:i.name,className:"h-full w-full object-cover"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-bold text-sm line-clamp-1",children:i.name}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:["Supplier ID: SUP-",i.id]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"p-4 bg-muted/50 rounded-xl border space-y-1",children:[e.jsx("p",{className:"text-[10px] uppercase font-bold text-muted-foreground",children:"Supplier Price"}),e.jsxs("p",{className:"text-xl font-bold",children:["$",x.toFixed(2)]})]}),e.jsxs("div",{className:"p-4 bg-primary/5 rounded-xl border border-primary/20 space-y-1",children:[e.jsx("p",{className:"text-[10px] uppercase font-bold text-primary italic",children:"Your Selling Price"}),e.jsxs("p",{className:"text-xl font-bold text-primary",children:["$",u]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs(L,{className:"font-bold flex items-center gap-2",children:["Markup Percentage: ",e.jsxs("span",{className:"text-primary font-black text-lg",children:[m,"%"]})]}),e.jsxs("div",{className:"flex items-center gap-1 text-[10px] font-medium text-green-600 bg-green-50 px-2 py-0.5 rounded border border-green-100",children:[e.jsx(ue,{className:"h-3 w-3"})," Profit: +$",C]})]}),e.jsx(de,{value:[m],onValueChange:N=>y(N[0]),max:200,step:1,className:"py-4"}),e.jsxs("div",{className:"flex justify-between text-[10px] text-muted-foreground",children:[e.jsx("span",{children:"0% (Cost price)"}),e.jsx("span",{children:"100% (Double)"}),e.jsx("span",{children:"200% (Triple)"})]})]}),e.jsxs("div",{className:"flex items-center justify-between p-4 bg-muted/30 rounded-xl border",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(L,{className:"font-bold",children:"Product Visibility"}),e.jsx("p",{className:"text-xs text-muted-foreground text-pretty",children:"Enable this to show product in your storefront."})]}),e.jsx(oe,{checked:d,onCheckedChange:g})]}),e.jsxs("div",{className:"flex items-start gap-3 p-3 bg-blue-50 dark:bg-blue-950/20 rounded-lg border border-blue-100 dark:border-blue-900/50",children:[e.jsx(me,{className:"h-4 w-4 text-blue-500 mt-0.5 shrink-0"}),e.jsx("p",{className:"text-[10px] text-blue-700 dark:text-blue-400 leading-normal",children:"Note: This is a dropshipping product. You can only control your margin. Product images and descriptions are managed by the supplier API."})]})]}),e.jsxs(X,{className:"gap-2 sm:gap-0",children:[e.jsx(l,{variant:"ghost",onClick:p,children:"Cancel"}),e.jsxs(l,{className:"gap-2 px-8",onClick:()=>P({margin:m,isVisible:d}),children:[e.jsx(xe,{className:"h-4 w-4"})," Save Changes"]})]})]})})},Le=()=>{const i=Z(),{toast:o}=ee(),[p,P]=a.useState("products"),[m,y]=a.useState([]),[d,g]=a.useState([]),[x,u]=a.useState([]),[C,N]=a.useState([]),[M,f]=a.useState(!0),[b,I]=a.useState("grid"),[F,_]=a.useState(""),[v,$]=a.useState(""),[n,h]=a.useState(1),[c,B]=a.useState(1),[A,Ne]=a.useState(null),[Y,E]=a.useState(!1),w=a.useRef(!1),k=a.useRef(!1),z=async()=>{if(!w.current){w.current=!0,f(!0);try{const s=await S.getSupplierProducts({page:n,size:20,keyWord:F,categoryId:v});g(s.products),B(s.totalPages)}catch(s){console.error("Failed to fetch products:",s),o({title:"Error",description:"Failed to fetch products from CJ API.",variant:"destructive"})}finally{f(!1),w.current=!1}}},Q=async()=>{if(!k.current){k.current=!0,f(!0);try{const s=await S.fetchCategories();u(s),N(s.map(t=>({id:t.categoryFirstId,name:t.categoryFirstName,subList:t.categoryFirstList,level:1})))}catch(s){console.error("Failed to fetch categories:",s)}finally{f(!1),k.current=!1}}};a.useEffect(()=>{Q()},[]),a.useEffect(()=>{z()},[n,v]);const U=s=>{s.preventDefault(),h(1),z()},D=s=>{i(`/admin/products/${s.id}`)},q=async s=>{try{await S.updateProductMargin(A.id,s.margin),o({title:"Pricing updated",description:"Product markup and visibility saved successfully."}),E(!1)}catch{o({title:"Update failed",description:"There was an error saving pricing settings.",variant:"destructive"})}};return e.jsxs("div",{className:"space-y-6 pb-10",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Supplied Products"}),e.jsx(j,{variant:"outline",className:"bg-indigo-50 text-indigo-700 dark:bg-indigo-900/30 border-indigo-200",children:"API Synced"})]}),e.jsx("p",{className:"text-muted-foreground",children:"Manage markups for products synced from the global dropship network."})]}),p==="products"&&e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("div",{className:"flex bg-muted rounded-lg p-1 border",children:[e.jsx(l,{variant:b==="grid"?"secondary":"ghost",size:"icon",className:"h-8 w-8",onClick:()=>I("grid"),children:e.jsx(he,{className:"h-4 w-4"})}),e.jsx(l,{variant:b==="list"?"secondary":"ghost",size:"icon",className:"h-8 w-8",onClick:()=>I("list"),children:e.jsx(je,{className:"h-4 w-4"})})]})})]}),e.jsx(R,{className:"border-none bg-muted/40 shadow-none",children:e.jsxs(V,{className:"p-4 flex flex-col md:flex-row items-center gap-4",children:[e.jsxs("form",{onSubmit:U,className:"relative flex-1 w-full",children:[e.jsx(se,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(ae,{placeholder:"Search by product name or global ID...",className:"pl-10 bg-background",value:F,onChange:s=>_(s.target.value)}),e.jsx(l,{type:"submit",className:"hidden",children:"Search"})]}),e.jsxs("select",{className:"h-10 rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",value:v,onChange:s=>{$(s.target.value),h(1)},children:[e.jsx("option",{value:"",children:"All Categories"}),x.map(s=>e.jsx("optgroup",{label:s.categoryFirstName,children:s.categoryFirstList?.map(t=>e.jsxs(te.Fragment,{children:[e.jsxs("option",{value:t.categorySecondId,children:["-- ",t.categorySecondName]}),t.categorySecondList?.map(r=>e.jsxs("option",{value:r.categoryId,children:["    ",r.categoryName]},r.categoryId))]},t.categorySecondId))},s.categoryFirstId))]})]})}),M&&d.length===0?e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6",children:Array.from({length:8}).map((s,t)=>e.jsx("div",{className:"h-80 bg-card rounded-xl border animate-pulse"},t))}):e.jsx(re,{children:b==="grid"?e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6",children:d.map((s,t)=>e.jsxs(ie.div,{layout:!0,initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},transition:{delay:t*.05},className:"group relative bg-card rounded-2xl border hover:shadow-xl transition-all overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"aspect-[4/3] relative overflow-hidden bg-muted",children:[e.jsx("img",{src:s.image,alt:s.name,className:"h-full w-full object-cover transition-transform group-hover:scale-105"}),e.jsxs("div",{className:"absolute top-2 right-2 flex flex-col gap-1",children:[e.jsxs(j,{className:"bg-green-500 hover:bg-green-600 border-none",children:["In Stock: ",s.stock]}),e.jsx(j,{variant:"secondary",className:"backdrop-blur-md bg-white/50 border-white/20",children:s.category})]})]}),e.jsxs("div",{className:"p-5 flex-1 flex flex-col gap-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("h3",{className:"font-bold text-sm line-clamp-2 min-h-[2.5rem] leading-tight",children:s.name}),e.jsxs("div",{className:"flex items-center gap-1.5 text-[10px] text-muted-foreground",children:[e.jsx(pe,{className:"h-3 w-3 text-indigo-500"}),"Verified Supplier"]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 p-3 bg-muted/50 rounded-xl border border-muted-foreground/10 text-xs",children:[e.jsxs("div",{className:"flex flex-col gap-0.5",children:[e.jsx("span",{className:"text-[10px] text-muted-foreground uppercase font-bold tracking-tighter",children:"Supplier Price"}),e.jsxs("span",{className:"font-medium text-muted-foreground",children:["₹",s.supplierPrice]})]}),e.jsxs("div",{className:"flex flex-col gap-0.5 border-l pl-3 border-muted-foreground/20",children:[e.jsx("span",{className:"text-[10px] text-primary uppercase font-bold tracking-tighter italic",children:"Your Price"}),e.jsxs("span",{className:"font-bold text-primary",children:["₹",s.price]})]})]}),e.jsxs("div",{className:"mt-auto pt-2 flex items-center justify-between gap-2",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-[10px] text-muted-foreground font-medium",children:"Profit Margin"}),e.jsxs("span",{className:"text-xs font-bold text-green-600",children:["+",s.margin,"%"]})]}),e.jsxs(l,{size:"sm",className:"gap-2 rounded-full px-4",onClick:()=>D(s),children:[e.jsx(T,{className:"h-3 w-3"})," View Product"]})]})]})]},s.id))}):e.jsx(R,{children:e.jsx(V,{className:"p-0",children:e.jsx("div",{className:"relative w-full overflow-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b bg-muted/30",children:[e.jsx("th",{className:"h-12 px-6 text-left align-middle font-medium text-muted-foreground",children:"Product"}),e.jsx("th",{className:"h-12 px-6 text-left align-middle font-medium text-muted-foreground",children:"Category"}),e.jsx("th",{className:"h-12 px-6 text-left align-middle font-medium text-muted-foreground",children:"Supplier Cost"}),e.jsx("th",{className:"h-12 px-6 text-left align-middle font-medium text-muted-foreground",children:"Markup"}),e.jsx("th",{className:"h-12 px-6 text-left align-middle font-medium text-muted-foreground text-primary font-bold italic",children:"Selling Price"}),e.jsx("th",{className:"h-12 px-6 text-right align-middle font-medium text-muted-foreground",children:"Stock"}),e.jsx("th",{className:"h-12 px-6 text-right align-middle font-medium text-muted-foreground",children:"Actions"})]})}),e.jsx("tbody",{children:d.map((s,t)=>e.jsxs("tr",{className:"border-b hover:bg-muted/50 transition-colors",children:[e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-10 w-10 rounded border overflow-hidden shrink-0",children:e.jsx("img",{src:s.image,className:"h-full w-full object-cover"})}),e.jsx("span",{className:"font-medium line-clamp-1 max-w-[200px]",children:s.name})]})}),e.jsx("td",{className:"px-6 py-4 text-xs",children:s.category}),e.jsxs("td",{className:"px-6 py-4 text-muted-foreground",children:["₹",s.supplierPrice]}),e.jsxs("td",{className:"px-6 py-4 text-green-600 font-medium",children:["+",s.margin,"%"]}),e.jsxs("td",{className:"px-6 py-4 font-bold text-primary",children:["₹",s.price]}),e.jsx("td",{className:"px-6 py-4 text-right",children:e.jsx(j,{variant:s.stock>10?"outline":"destructive",className:"rounded-full",children:s.stock})}),e.jsx("td",{className:"px-6 py-4 text-right",children:e.jsx(l,{variant:"ghost",size:"icon",className:"h-8 w-8 text-indigo-600",onClick:()=>D(s),children:e.jsx(T,{className:"h-4 w-4"})})})]},s.id))})]})})})})}),!M&&c>1&&e.jsxs("div",{className:"flex items-center justify-center gap-2 mt-8",children:[e.jsxs(l,{variant:"outline",size:"sm",onClick:()=>h(s=>Math.max(1,s-1)),disabled:n===1,children:[e.jsx(le,{className:"h-4 w-4 mr-1"})," Previous"]}),e.jsx("div",{className:"flex items-center gap-1",children:Array.from({length:Math.min(5,c)}).map((s,t)=>{let r;return c<=5||n<=3?r=t+1:n>=c-2?r=c-4+t:r=n-2+t,e.jsx(l,{variant:n===r?"primary":"outline",size:"sm",className:"h-8 w-8 p-0",onClick:()=>h(r),children:r},r)})}),e.jsxs(l,{variant:"outline",size:"sm",onClick:()=>h(s=>Math.min(c,s+1)),disabled:n===c,children:["Next ",e.jsx(ne,{className:"h-4 w-4 ml-1"})]})]}),e.jsxs("div",{className:"flex items-center justify-center gap-4 py-8 opacity-40 hover:opacity-100 transition-opacity",children:[e.jsx(ce,{className:"h-5 w-5"}),e.jsx("p",{className:"text-xs max-w-lg text-center font-medium",children:"As a dropshipping platform, product details are automatically managed by the supplier API. V-COMMERCE admins can only control markup percentages and storefront visibility."})]}),e.jsx(ye,{product:A,isOpen:Y,onClose:()=>E(!1),onSave:q})]})};export{Le as default};
