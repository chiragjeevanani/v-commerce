import{u as Q,b as X,r,R as V,j as e,S as ee,c as se,B as $,d as te,e as re,f as ae,g as ce,m as B,A as ie}from"./index-BpRMWdVM.js";import{s as oe}from"./storeProduct.service-rvafYFD0.js";import{c as O}from"./category.service-DQIBe2NB.js";import{S as ne}from"./StoreProductCard-DwYQ3Et7.js";import{S as le}from"./slider-BS68g0dW.js";import{C as U}from"./checkbox-D_9u4xlA.js";import{S as de,a as me,b as ue,c as he,d as j}from"./select-C9VlvrKJ.js";import{S as ge}from"./SkeletonCard-CdR-J2Np.js";import{F as xe}from"./funnel-CpbcXKkx.js";import{L as fe}from"./loader-circle-BIr11ka_.js";import"./card-CyVSnPS_.js";import"./eye-D0NRzLWa.js";import"./index-BdQq_4o_.js";import"./index-D0VtG131.js";const Me=()=>{const[d,S]=Q(),{toast:W}=X(),[m,C]=r.useState([]),[Y,q]=r.useState([]),[_,y]=r.useState([]),[v,E]=r.useState(!0),[N,L]=r.useState(!1),[f,F]=r.useState(1),[P,D]=r.useState(!0),[M,w]=r.useState([0,1e5]),[n,k]=r.useState([0,1e5]),[u,b]=r.useState([]),[A,h]=r.useState([]),[g,I]=r.useState("newest"),x=r.useRef(null);r.useEffect(()=>{Z()},[]),r.useEffect(()=>{u.length>0?z(u[0]):(y([]),h([]))},[u]),r.useEffect(()=>{F(1),R(1,!0)},[d]),r.useEffect(()=>{f>1&&R(f,!1)},[f]),r.useEffect(()=>{const s=()=>{if(v||N||!P)return;const t=window.innerHeight,c=window.scrollY,o=document.documentElement.scrollHeight;t+c>=o-500&&F(a=>a+1)};return window.addEventListener("scroll",s),()=>window.removeEventListener("scroll",s)},[v,N,P,f]);const Z=async()=>{try{const s=await O.getActiveCategories();s.success&&q(s.data)}catch(s){console.error("Error fetching categories",s)}},z=async s=>{try{const t=await O.getSubcategoriesByCategory(s);t.success&&y(t.data.filter(c=>c.isActive))}catch(t){console.error("Error fetching subcategories",t),y([])}},R=async(s,t=!1)=>{t?E(!0):L(!0);try{const c=d.get("category"),o=d.get("subcategory"),a=d.get("search"),i={page:s,limit:20};a&&(i.search=a),c&&(i.categoryId=c),o&&(i.subcategoryId=o);const p=await oe.getActiveProducts(i);p.success&&(C(s===1?p.data:K=>[...K,...p.data]),D(p.data.length===20))}catch(c){console.error("Error fetching products",c),W({title:"Error",description:"Failed to load products.",variant:"destructive"})}finally{E(!1),L(!1)}},G=s=>{const t=new URLSearchParams(d);u.includes(s)?(t.delete("category"),b([]),h([])):(t.set("category",s),b([s]),h([])),S(t)},J=s=>{const t=new URLSearchParams(d);A.includes(s)?(t.delete("subcategory"),h(c=>c.filter(o=>o!==s))):(t.set("subcategory",s),h(c=>[...c,s])),S(t)},H=V.useMemo(()=>{if(m.length===0)return[];const[s,t]=M;let o=m.map(a=>({...a,_computedPrice:a.price||0})).filter(a=>a._computedPrice>=s&&a._computedPrice<=t);return g==="price-low"?o.sort((a,i)=>a._computedPrice-i._computedPrice):g==="price-high"?o.sort((a,i)=>i._computedPrice-a._computedPrice):g==="name"&&o.sort((a,i)=>a.name.localeCompare(i.name)),o.map(({_computedPrice:a,...i})=>i)},[m,M,g]),l=V.useMemo(()=>m.length===0?1e5:Math.max(...m.map(s=>s.price||0),1e5),[m]);r.useEffect(()=>{x.current&&clearTimeout(x.current);const s=requestAnimationFrame(()=>{x.current=setTimeout(()=>{w(n)},100)});return()=>{cancelAnimationFrame(s),x.current&&clearTimeout(x.current)}},[n]),r.useEffect(()=>{if(l>0){const s=n[1];if(s>l||s===0){const t=[n[0],l];k(t),w(t)}}},[l]);const T=()=>e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Categories"}),e.jsx("div",{className:"space-y-1 max-h-[400px] overflow-y-auto pr-2 scrollbar-thin",children:Y.map(s=>e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center space-x-2 py-1",children:[e.jsx(U,{id:`cat-${s._id}`,checked:u.includes(s._id),onCheckedChange:()=>G(s._id)}),e.jsx("label",{htmlFor:`cat-${s._id}`,className:"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70 cursor-pointer",children:s.name})]}),u.includes(s._id)&&_.length>0&&e.jsx("div",{className:"ml-6 space-y-1",children:_.map(t=>e.jsxs("div",{className:"flex items-center space-x-2 py-1",children:[e.jsx(U,{id:`subcat-${t._id}`,checked:A.includes(t._id),onCheckedChange:()=>J(t._id)}),e.jsx("label",{htmlFor:`subcat-${t._id}`,className:"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70 cursor-pointer",children:t.name})]},t._id))})]},s._id))})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Price Range"}),e.jsx(le,{max:l,min:0,step:Math.max(100,Math.floor(l/200)),value:n,onValueChange:s=>{k(s)},className:"mb-4"}),e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsxs("span",{className:"font-medium",children:["₹",Math.round(n[0]).toLocaleString("en-IN")]}),e.jsxs("span",{className:"font-medium",children:["₹",Math.round(n[1]).toLocaleString("en-IN")]})]})]})]});return e.jsx("div",{className:"container py-8",children:e.jsxs("div",{className:"flex flex-col md:flex-row gap-8",children:[e.jsx("div",{className:"hidden md:block w-64 flex-shrink-0 space-y-8",children:e.jsx(T,{})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Store Products"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(ee,{children:[e.jsx(se,{asChild:!0,children:e.jsxs($,{variant:"outline",className:"md:hidden",children:[e.jsx(xe,{className:"mr-2 h-4 w-4"})," Filters"]})}),e.jsxs(te,{side:"left",children:[e.jsxs(re,{children:[e.jsx(ae,{children:"Filters"}),e.jsx(ce,{className:"sr-only",children:"Filter products by category and price range."})]}),e.jsx("div",{className:"mt-6",children:e.jsx(T,{})})]})]}),e.jsxs(de,{value:g,onValueChange:I,children:[e.jsx(me,{className:"w-[180px]",children:e.jsx(ue,{placeholder:"Sort by"})}),e.jsxs(he,{children:[e.jsx(j,{value:"newest",children:"Newest"}),e.jsx(j,{value:"price-low",children:"Price: Low to High"}),e.jsx(j,{value:"price-high",children:"Price: High to Low"}),e.jsx(j,{value:"name",children:"Name: A-Z"})]})]})]})]}),v?e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 gap-3 md:gap-6",children:Array.from({length:20}).map((s,t)=>e.jsx(ge,{},t))}):H.length>0?e.jsxs(e.Fragment,{children:[e.jsx(B.div,{layout:!0,className:"grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 gap-3 md:gap-6",children:e.jsx(ie,{mode:"popLayout",children:H.map((s,t)=>e.jsx(B.div,{layout:!0,initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.9},transition:{duration:.3,delay:t%20*.05},children:e.jsx(ne,{product:s})},s._id||t))})}),(P||N)&&e.jsxs("div",{className:"h-20 flex items-center justify-center mt-8 mb-20",children:[e.jsx(fe,{className:"h-8 w-8 animate-spin text-primary"}),e.jsx("span",{className:"ml-2 text-muted-foreground",children:"Loading more products..."})]})]}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx("p",{className:"text-xl text-muted-foreground",children:"No products found."}),e.jsx($,{variant:"link",onClick:()=>{b([]),h([]),w([0,l]),S({})},children:"Clear all filters"})]})]})]})})};export{Me as default};
