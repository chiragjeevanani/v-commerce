import{u as V,b as D,r as a,R as O,j as e,S as Y,c as $,B as L,d as z,e as U,f as W,g as _,m as k,A as q}from"./index-BOPlgZ3J.js";import{p as R}from"./products.service-BlFkR9YO.js";import{P as G}from"./ProductCard-BcW3mFpj.js";import{S as J}from"./slider-C6WqZo6P.js";import{C as K}from"./checkbox-D2a84SL6.js";import{S as Q,a as X,b as Z,c as ee,d as x}from"./select-DZybM1w6.js";import{S as se}from"./SkeletonCard-BxTiH4JZ.js";import{F as te}from"./funnel-UFEPwd7n.js";import{L as re}from"./loader-circle-CcdxeJYH.js";import"./mockData-Da8oLpbF.js";import"./card-B7rOivQ7.js";import"./eye-BHP40aTH.js";import"./index-BdQq_4o_.js";import"./index-BtwGHCuY.js";const ye=()=>{const[d,f]=V(),{toast:H}=D(),[j,S]=a.useState([]),[T,A]=a.useState([]),[p,y]=a.useState(!0),[u,v]=a.useState(!1),[n,P]=a.useState(1),[h,N]=a.useState(!0),[o,w]=a.useState([0,1e3]),[C,g]=a.useState([]),[m,B]=a.useState("featured"),[ae,le]=a.useState(20);a.useRef(null),a.useEffect(()=>{(async()=>{try{const t=await R.fetchCategories();if(t){const r=[];t.forEach(l=>{r.push({id:l.categoryFirstId,name:l.categoryFirstName,level:1}),l.categoryFirstList?.forEach(i=>{r.push({id:i.categorySecondId,name:i.categorySecondName,level:2}),i.categorySecondList?.forEach(c=>{r.push({id:c.categoryId,name:c.categoryName,level:3})})})}),A(r)}}catch(t){console.error("Error fetching categories",t)}})()},[]);const F=async(s,t=!1)=>{t?y(!0):v(!0);try{const r=d.get("category"),l=d.get("search"),i={page:s,size:20,categoryId:r||void 0,keyWord:l||void 0},c=await R.getSupplierProducts(i);c&&c.products?(S(s===1?c.products:M=>[...M,...c.products]),N(c.products.length===20)):N(!1)}catch(r){console.error("Error fetching products",r),H({title:"Error",description:"Failed to load products.",variant:"destructive"})}finally{y(!1),v(!1)}};a.useEffect(()=>{P(1),F(1,!0)},[d]),a.useEffect(()=>{n>1&&F(n)},[n]),a.useEffect(()=>{const s=()=>{if(p||u||!h)return;const t=window.innerHeight,r=window.scrollY,l=document.documentElement.scrollHeight;t+r>=l-500&&(console.log("Triggering next page",n+1),P(i=>i+1))};return window.addEventListener("scroll",s),()=>window.removeEventListener("scroll",s)},[p,u,h,n]);const b=O.useMemo(()=>{let s=[...j];return s=s.filter(t=>{const r=String(t.sellPrice||"0"),l=r.includes("-")?parseFloat(r.split("-")[0]):parseFloat(r);return l>=o[0]&&l<=o[1]}),m==="price-asc"?s.sort((t,r)=>{const l=String(t.sellPrice).includes("-")?parseFloat(t.sellPrice.split("-")[0]):parseFloat(t.sellPrice),i=String(r.sellPrice).includes("-")?parseFloat(r.sellPrice.split("-")[0]):parseFloat(r.sellPrice);return l-i}):m==="price-desc"&&s.sort((t,r)=>{const l=String(t.sellPrice).includes("-")?parseFloat(t.sellPrice.split("-")[0]):parseFloat(t.sellPrice);return(String(r.sellPrice).includes("-")?parseFloat(r.sellPrice.split("-")[0]):parseFloat(r.sellPrice))-l}),s},[j,o,m]),I=s=>{const t=new URLSearchParams(d);C.includes(s)?(t.delete("category"),g([])):(t.set("category",s),g([s])),f(t)},E=()=>e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Top Categories"}),e.jsx("div",{className:"space-y-1 max-h-[400px] overflow-y-auto pr-2 scrollbar-thin",children:T.filter(s=>s.level===1).map(s=>e.jsxs("div",{className:"flex items-center space-x-2 py-1",children:[e.jsx(K,{id:`cat-${s.id}`,checked:C.includes(s.id),onCheckedChange:()=>I(s.id)}),e.jsx("label",{htmlFor:`cat-${s.id}`,className:"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70 cursor-pointer",children:s.name})]},s.id))})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Price Range"}),e.jsx(J,{defaultValue:[0,1e3],max:1e3,step:10,value:o,onValueChange:w,className:"mb-4"}),e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsxs("span",{children:["₹",o[0]]}),e.jsxs("span",{children:["₹",o[1]]})]})]})]});return e.jsx("div",{className:"container py-8",children:e.jsxs("div",{className:"flex flex-col md:flex-row gap-8",children:[e.jsx("div",{className:"hidden md:block w-64 flex-shrink-0 space-y-8",children:e.jsx(E,{})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Shop"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(Y,{children:[e.jsx($,{asChild:!0,children:e.jsxs(L,{variant:"outline",className:"md:hidden",children:[e.jsx(te,{className:"mr-2 h-4 w-4"})," Filters"]})}),e.jsxs(z,{side:"left",children:[e.jsxs(U,{children:[e.jsx(W,{children:"Filters"}),e.jsx(_,{className:"sr-only",children:"Filter products by category and price range."})]}),e.jsx("div",{className:"mt-6",children:e.jsx(E,{})})]})]}),e.jsxs(Q,{value:m,onValueChange:B,children:[e.jsx(X,{className:"w-[180px]",children:e.jsx(Z,{placeholder:"Sort by"})}),e.jsxs(ee,{children:[e.jsx(x,{value:"featured",children:"Featured"}),e.jsx(x,{value:"price-asc",children:"Price: Low to High"}),e.jsx(x,{value:"price-desc",children:"Price: High to Low"})]})]})]})]}),p?e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 gap-3 md:gap-6",children:Array.from({length:20}).map((s,t)=>e.jsx(se,{},t))}):b.length>0?e.jsxs(e.Fragment,{children:[e.jsx(k.div,{layout:!0,className:"grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 gap-3 md:gap-6",children:e.jsx(q,{mode:"popLayout",children:b.map((s,t)=>e.jsx(k.div,{layout:!0,initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.9},transition:{duration:.3,delay:t%20*.05},children:e.jsx(G,{product:s})},s.id||t))})}),(h||u)&&e.jsxs("div",{className:"h-20 flex items-center justify-center mt-8 mb-20",children:[e.jsx(re,{className:"h-8 w-8 animate-spin text-primary"}),e.jsx("span",{className:"ml-2 text-muted-foreground",children:"Loading more products..."})]})]}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx("p",{className:"text-xl text-muted-foreground",children:"No products found."}),e.jsx(L,{variant:"link",onClick:()=>{g([]),w([0,1e3]),f({})},children:"Clear all filters"})]})]})]})})};export{ye as default};
